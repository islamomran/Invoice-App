<!DOCTYPE html>
<html lang="en">
<meta content="text/html;charset=utf-8" http-equiv="content-type"/>
<head>
    <meta charset="utf-8">
    <meta content="ie=edge" http-equiv="x-ua-compatible">
<!--    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="A simple jQuery image cropping plugin." name="description">
    <meta content="Chen Fengyuan" name="author">

    <title>Invoice</title>

<!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">-->

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropper/4.0.0/cropper.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="/resources/demos/style.css" rel="stylesheet">
    <link href="https://transloadit.edgly.net/releases/uppy/v1.3.0/uppy.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        $( function() {
            $( "#sortable" ).sortable();
            $( "#sortable" ).disableSelection();
        } );
    </script>
    <!--    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.7.8/angular.min.js"></script>-->
    <style>
        .pdL0 {
            padding-left: 0 !important;
        }

        .navbar {
            margin: 0;
        }

        .docs-buttons {
            margin-bottom: 10px;
        }

        .simpleDemo ul[dnd-list] {
            min-height: 42px;
            padding-left: 0px;
        }

        .simpleDemo ul[dnd-list] .dndDraggingSource {
            display: none;
        }

        .container.main {
            width: 100% !important;
        }

        .button.box-body {
            margin: 10px 0 !important;
        }

        .simpleDemo ul[dnd-list] .dndPlaceholder {
            background-color: #ddd;
            display: block;
            min-height: 42px;
        }

        .simpleDemo ul[dnd-list] li {
            background-color: #fff;
            border: 1px solid #ddd;
            border-top-right-radius: 4px;
            border-top-left-radius: 4px;
            display: block;
            padding: 10px 15px;
            margin-bottom: -1px;
        }

        .img-container img {
            width: 100%;
        }

        .MT10 {
            margin-top: 10px;
        }

        .simpleDemo ul[dnd-list] li.selected {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .download_btn{
            display:none;
        }
        /*#sortable { list-style-type: none; margin: 0; padding: 0; width: 60%; }*/
        /*#sortable li { margin: 0 3px 3px 3px; padding: 0.4em; padding-left: 1.5em; font-size: 1.4em; height: 18px; }*/
        /*#sortable li span { position: absolute; margin-left: -1.3em; }*/
    </style>

</head>

<body class="main">

<form role="form">

    <div class="container main">
        <div class="row header">
            <div>
                <h5>Notifications</h5>
            </div>
        </div>
        <!-- header end -->
        <!-- wrapper start here -->
        <div class="row">
            <!-- invoice left start -->
            <div class="col-md-4 pd0">
                <div class="box box-primary">
    <!-- /.box-header -->
    <!-- form start -->
    <div class="box-body">
        <div class="form-group">
            <div class="row">
                <label>Supplier Name</label>
                <select class="form-control">
                    <option>option 1</option>
                    <option>option 2</option>
                    <option>option 3</option>
                    <option>option 4</option>
                    <option>option 5</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <div class="row">
                <label for="invoicenumber">Invoice No.</label>
                <input class="form-control" id="invoicenumber" placeholder="Enter invoice number"
                       type="text">
            </div>
        </div>
        <hr>
        <div class="form-group">
            <div class="row">
                <label for="invoicedate">Invoice Date</label>
                <p>12-12-19</p>
            </div>
        </div>
        <div class="form-group">
            <div class="row">
                <label for="invoicedate">Customer Name</label>
                <p>Ranbir Steel Industry</p>
            </div>
        </div>
        <div class="form-group">
            <div class="row">
                <table class="border table">
                    <tr>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Ammount</th>
                    </tr>
                    <tr>
                        <td>Item</td>
                        <td>Quantity</td>
                        <td>Ammount</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <!-- /.box-body -->
</div>
            </div>
            <!-- invoice left end -->
            <!-- invoice right block start -->
            <div class="col-md-8">
                <div class="box box-primary">
                    <div class="row">
                        <div class="col-md-8">
                            <!-- Content -->
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-md-12 docs-buttons">
                                        <div class="btn-group">
                                            <button class="btn btn-primary" data-method="zoom" data-option="0.1"
                                                    title="Zoom In" type="button">
                                                <span class="docs-tooltip" data-animation="false"
                                                      data-toggle="tooltip"
                                                      title="$().cropper(&quot;zoom&quot;, 0.1)">
                                                    <span class="fa fa-search-plus"></span>
                                                </span>
                                            </button>
                                            <button class="btn btn-primary" data-method="zoom" data-option="-0.1"
                                                    title="Zoom Out" type="button">
                                                  <span class="docs-tooltip" data-animation="false" data-toggle="tooltip"
                                                      title="$().cropper(&quot;zoom&quot;, -0.1)">
                                                    <span class="fa fa-search-minus"></span>
                                                </span>
                                            </button>
                                        </div>
                                        <div class="btn-group">
                                            <button class="btn btn-primary" data-method="rotate" data-option="-5"
                                                    title="Rotate Left" type="button">
                                                <span class="docs-tooltip" data-animation="false"
                                                      data-toggle="tooltip"
                                                      title="$().cropper(&quot;rotate&quot;, -5)">
                                                    <span class="fa fa-rotate-left"></span>
                                                </span>
                                            </button>
                                            <button class="btn btn-primary" data-method="rotate" data-option="5"
                                                    title="Rotate Right" type="button">
                                                <span class="docs-tooltip" data-animation="false"
                                                      data-toggle="tooltip"
                                                      title="$().cropper(&quot;rotate&quot;, 5)">
                                                    <span class="fa fa-rotate-right"></span>
                                                </span>
                                            </button>
                                        </div>
                                        <div class="btn-group">
                                            <button class="btn btn-primary" data-method="scaleY" data-option="-1"
                                                    title="Flip Vertical" type="button">
                                                <span class="docs-tooltip" data-animation="false"
                                                      data-toggle="tooltip"
                                                      title="$().cropper(&quot;scaleY&quot;, -1)">
                                                    <span class="fa fa-arrows-v"></span>
                                                </span>
                                            </button>
                                        </div>
                                        <div class="btn-group">
                                            <button class="btn btn-primary" data-method="crop" title="Crop"
                                                    type="button">
                                                <span class="docs-tooltip" data-animation="false"
                                                      data-toggle="tooltip"
                                                      title="$().cropper(&quot;crop&quot;)">
                                                    <span class="fa fa-check"></span>
                                                </span>
                                            </button>
                                        </div>
                                        <div class="btn-group">
                                            <button class="btn btn-primary" data-method="reset" title="Reset"
                                                    type="button">
                                                <span class="docs-tooltip" data-animation="false"
                                                      data-toggle="tooltip"
                                                      title="$().cropper(&quot;reset&quot;)">
                                                    <span class="fa fa-refresh"></span>
                                                </span>
                                            </button>
                                        </div>
                                        <div class="btn-group">
                                            <button class="btn btn-primary" id="add_content_to_uppy"
                                                    type="button">
                                                save
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12 pd0">
                                        <!-- <h3>Demo:</h3> -->
                                        <div class="img-container">
                                            <img alt="Picture" id="image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=">
                                        </div>
                                    </div>
                                </div>

                                <!-- uppy file upload -->
                                <div class="row MT10">
                                    <div class="col-md-10 ">
                                        <div class="for-ProgressBar "></div>
                                        <div class="uploaded-files ">
                                            <h5>Files to be updated:</h5>
                                            <ol></ol>
                                        </div>
                                    </div>
                                    <div class="col-md-2 pd0">
                                        <div class="row">
                                             <div class="btn-group right">
                                                <a class="btn btn-primary download_btn" download="cropped.html"
                                                   href="javascript:void(0);"
                                                   id="download"></a>
                                                <Updatea class="btn btn-primary" download="cropped.html"
                                                   href="javascript:void(0);"
                                                   id="upload-uppy">Update</Updatea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Content end here -->
                        </div>
                        <div class="col-md-4">
                            
                            <div class="box-body">
                                <h5 class="heading">List of Invoice</h5>

                                <ul class="list-group" id="sortable">
                                    <li class="ui-state-default list-group-item"
                                        data-ng-repeat="imagesrc in imageUrls"
                                        ng-click="loadImage(imagesrc)">
                                        <span class="handle ui-sortable-handle">
                                            <i class="fa fa-ellipsis-v"></i>
                                            <i class="fa fa-ellipsis-v"></i>
                                        </span>
                                        <span id="image-{{$index}}" class="text">Page-{{$index + 1}}</span>
                                    </li>
                                </ul>
<!--                                <ul class="list-group" id="sortable">-->
<!--                                    <li-->
<!--                                        class="ui-state-default list-group-item"-->
<!--                                        data-ng-repeat="imagesrc in imageUrls"-->
<!--                                        ng-click="loadImage(imagesrc)">-->
<!--                                        <span class="handle ui-sortable-handle">-->
<!--                                            <i class="fa fa-ellipsis-v"></i>-->
<!--                                            <i class="fa fa-ellipsis-v"></i>-->
<!--                                        </span>-->
<!--                                        <span id="image-{{$index}}" class="text">Page-{{$index + 1}}</span>-->
<!--                                    </li>-->
<!--                                </ul>-->
                            </div>
                            

                        </div>
                    </div>
                </div>
            </div>
            <!-- invoice right block end -->
        </div>

        <hr>

        
    <div class="row">
        <div class="button box-body ">
            <select cam-variable-name="dataEntryApproval" required
                    cam-variable-type="String">
                <option value="approve">Approve</option>
                <option value="reject">Reject</option>
            </select>
        </div>
    </div>


    </div>

    <script cam-script type="text/form-script">
		inject([ '$scope', '$http', '$window', function($scope, $http, $window) {

		    $scope.loadImage = function (url) {
		        // Dont use $, as $ is over shadowed by angular jquery mini and it does not contane data context
                jQuery("#image").data("cropper").replace(url);
		    }

    		camForm.on('form-loaded', function() {
				camForm.variableManager.fetchVariable('imageUrl');
			});
			camForm.on('variables-fetched', function() {
				$scope.imageUrls = JSON.parse(camForm.variableManager.variableValue('imageUrl'));
			});
            camForm.on('variables-applied', function() {

            console.log("Log");

           //document.querySelector('#image').addEventListener('ready', function () {


            setTimeout(() => {
                $scope.loadImage($scope.imageUrls[0]);
            }, 0);

            //});

            /*    $scope.mapOptions = {
                    zoom:15,
                    center:{
                      lat:parseFloat($scope.fulfilment.latitude),
                      lng:parseFloat($scope.fulfilment.longitude)
                    }
                };
                $scope.map = new google.maps.Map(document.getElementById('map'), $scope.mapOptions);
                $scope.marker = new google.maps.Marker({
                    position: {
                      lat:parseFloat($scope.fulfilment.latitude),
                      lng:parseFloat($scope.fulfilment.longitude)
                    },
                    map: $scope.map,
                    title: $scope.fulfilment.customer.name,
                });
             */

            });
	    }]);
	</script>

</form>




<!-- wrapper end here -->
</body>

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>-->
<!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropper/4.0.0/cropper.min.js"></script>
<!--<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>-->
<script src="https://www.alpineenergy.in/public/main.js"></script>
<script src="https://transloadit.edgly.net/releases/uppy/v1.3.0/uppy.min.js"></script>

<script>
    var images = [];
    var uppy = Uppy.Core({
        autoProceed: false,
        allowMultipleUploads: true,
        debug: false,
        restrictions: {
            maxFileSize: null,
            maxNumberOfFiles: null,
            minNumberOfFiles: null,
            allowedFileTypes: null
        },
        meta: {}
    })
    .use(Uppy.ProgressBar, {
        target: '.for-ProgressBar',
        hideAfterFinish: true
    })
    .use(Uppy.Tus, {endpoint: 'https://master.tus.io/files/'})
    .on('upload-success', (file, response) => {
        images.push(response.uploadURL);
        $('.uploaded-files ol').empty();
    }).on('file-added', (file) => {
        $('.uploaded-files ol').append(`<li id="${file.name}">${file.name}</li>`);
    });
    // .on('file-removed', (file) => {
    //     console.log('Removed file', file)
    // });

    document.querySelector('#upload-uppy').addEventListener('click', () => {
        uppy.upload();
    });

    window.cropper = $('#image').data('cropper');

    document.querySelector('#add_content_to_uppy').addEventListener('click', () => {
        let cropper = $('#image').data('cropper');
        cropper.getCroppedCanvas().toBlob((blob) => {
            uppy.addFile({
                name: 'file_name.jpeg', // file name
                type: 'image/jpeg', // file type
                data: blob, // file blob
                source: 'Local',
                isRemote: false
            });
        });
    });

</script>

</html>
